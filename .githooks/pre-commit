#!/bin/bash

# Pre-commit hook to check for build artifacts
# 防止构建产物被意外提交

echo "🔍 运行pre-commit检查..."

# 检查是否有构建产物被添加到暂存区
STAGED_FILES=$(git diff --cached --name-only)

# 检查暂存的文件是否包含构建产物
BUILD_ARTIFACTS=(
    "node_modules/"
    "dist/"
    ".turbo/"
    "build/"
    ".next/"
    "coverage/"
    "prisma/generated/"
    "generated/"
)

for file in $STAGED_FILES; do
    for artifact in "${BUILD_ARTIFACTS[@]}"; do
        if [[ $file == *"$artifact"* ]]; then
            echo "❌ 错误: 检测到构建产物 '$file' 被添加到暂存区"
            echo "请从暂存区移除此文件: git reset HEAD '$file'"
            echo "并确保该文件类型在.gitignore中"
            exit 1
        fi
    done
done

echo "✅ Pre-commit检查通过"
