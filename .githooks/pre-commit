#!/bin/bash

# Pre-commit hook to check for build artifacts
# é˜²æ­¢æ„å»ºäº§ç‰©è¢«æ„å¤–æäº¤

echo "ğŸ” è¿è¡Œpre-commitæ£€æŸ¥..."

# æ£€æŸ¥æ˜¯å¦æœ‰æ„å»ºäº§ç‰©è¢«æ·»åŠ åˆ°æš‚å­˜åŒº
STAGED_FILES=$(git diff --cached --name-only)

# æ£€æŸ¥æš‚å­˜çš„æ–‡ä»¶æ˜¯å¦åŒ…å«æ„å»ºäº§ç‰©
BUILD_ARTIFACTS=(
    "node_modules/"
    "dist/"
    ".turbo/"
    "build/"
    ".next/"
    "coverage/"
    "prisma/generated/"
    "generated/"
)

for file in $STAGED_FILES; do
    for artifact in "${BUILD_ARTIFACTS[@]}"; do
        if [[ $file == *"$artifact"* ]]; then
            echo "âŒ é”™è¯¯: æ£€æµ‹åˆ°æ„å»ºäº§ç‰© '$file' è¢«æ·»åŠ åˆ°æš‚å­˜åŒº"
            echo "è¯·ä»æš‚å­˜åŒºç§»é™¤æ­¤æ–‡ä»¶: git reset HEAD '$file'"
            echo "å¹¶ç¡®ä¿è¯¥æ–‡ä»¶ç±»å‹åœ¨.gitignoreä¸­"
            exit 1
        fi
    done
done

echo "âœ… Pre-commitæ£€æŸ¥é€šè¿‡"
