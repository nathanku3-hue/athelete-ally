[phases.setup]
nixPkgs = ["nodejs_20"]
# Force redeploy: 2025-10-23 13:42 UTC - workspace build fix

[phases.install]
cmds = ["npm ci --workspaces --include-workspace-root --include=dev --no-audit --no-fund"]

[phases.build]
cmds = [
  "npm run build:planning-engine",
  "echo '=== Checking dist folder ===' && ls -la services/planning-engine/ || true",
  "echo '=== Dist contents ===' && ls -la services/planning-engine/dist/ || echo 'ERROR: No dist folder'",
  "test -f services/planning-engine/dist/index.js && echo 'SUCCESS: index.js found' || echo 'ERROR: index.js missing'"
]

[start]
cmd = "node services/planning-engine/dist/index.js"
