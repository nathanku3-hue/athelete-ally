# æƒé™ç³»ç»Ÿç”¨æˆ·æ•…äº‹ä¸éªŒæ”¶æ ‡å‡†

## æ‰§è¡Œæ‘˜è¦

ä½œä¸ºå·¥ç¨‹å¸ˆBï¼ˆå‰ç«¯é›†æˆä¸“å®¶ï¼‰ï¼Œæˆ‘è´Ÿè´£å®šä¹‰å’ŒéªŒè¯æ–°çš„æƒé™ç³»ç»Ÿçš„ç”¨æˆ·é¢å‘æ–¹é¢ã€‚æœ¬æ–‡æ¡£å®šä¹‰äº†Protocolå’ŒBlockæƒé™ç®¡ç†çš„ç”¨æˆ·æ•…äº‹ã€éªŒæ”¶æ ‡å‡†å’Œæµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨ã€é€»è¾‘æ¸…æ™°ä¸”å¯æµ‹è¯•ã€‚

## ğŸ¯ æƒé™ç³»ç»Ÿæ¦‚è¿°

### æ ¸å¿ƒæƒé™ç±»å‹
- **read**: æŸ¥çœ‹åè®®/å—å†…å®¹
- **write**: ä¿®æ”¹åè®®/å—å†…å®¹
- **execute**: æ‰§è¡Œåè®®/å—
- **share**: åˆ†äº«åè®®/å—ç»™å…¶ä»–ç”¨æˆ·

### æƒé™å±‚çº§
1. **Protocolçº§åˆ«**: å¯¹æ•´ä¸ªåè®®åŠå…¶æ‰€æœ‰å—çš„æƒé™
2. **Blockçº§åˆ«**: å¯¹ç‰¹å®šå—çš„æƒé™
3. **Sessionçº§åˆ«**: å¯¹ç‰¹å®šè®­ç»ƒä¼šè¯çš„æƒé™

## ğŸ“‹ ç”¨æˆ·æ•…äº‹

### Epic 1: åè®®æ‰€æœ‰æƒç®¡ç†

#### US-001: åè®®åˆ›å»ºä¸æ‰€æœ‰æƒ
**ä½œä¸º** ä¸€ä¸ªæ³¨å†Œç”¨æˆ·  
**æˆ‘å¸Œæœ›** èƒ½å¤Ÿåˆ›å»ºæ–°çš„è®­ç»ƒåè®®  
**ä»¥ä¾¿** æˆ‘å¯ä»¥ç®¡ç†è‡ªå·±çš„è®­ç»ƒè®¡åˆ’

**éªŒæ”¶æ ‡å‡†:**
- [ ] ç”¨æˆ·å¯ä»¥åˆ›å»ºæ–°åè®®
- [ ] åˆ›å»ºè€…è‡ªåŠ¨è·å¾—æ‰€æœ‰æƒé™ï¼ˆread, write, execute, shareï¼‰
- [ ] åè®®é»˜è®¤ä¸ºç§æœ‰ï¼ˆisPublic = falseï¼‰
- [ ] åˆ›å»ºè€…å¯ä»¥è®¾ç½®åè®®ä¸ºå…¬å¼€
- [ ] åè®®åˆ›å»ºåç«‹å³åœ¨ç”¨æˆ·åè®®åˆ—è¡¨ä¸­æ˜¾ç¤º

**æµ‹è¯•ç”¨ä¾‹:**
```typescript
// TC-001: åˆ›å»ºåè®®
Given ç”¨æˆ·å·²ç™»å½•
When ç”¨æˆ·åˆ›å»ºæ–°åè®® "5/3/1 Strength Program"
Then åè®®åˆ›å»ºæˆåŠŸ
And ç”¨æˆ·è·å¾—æ‰€æœ‰æƒé™
And åè®®åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­æ˜¾ç¤º

// TC-002: åè®®æ‰€æœ‰æƒéªŒè¯
Given ç”¨æˆ·Aåˆ›å»ºäº†åè®®
When ç”¨æˆ·AæŸ¥çœ‹åè®®åˆ—è¡¨
Then åè®®æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­
And ç”¨æˆ·Aå¯ä»¥ç¼–è¾‘åè®®
```

#### US-002: åè®®è®¿é—®æ§åˆ¶
**ä½œä¸º** ä¸€ä¸ªç”¨æˆ·  
**æˆ‘å¸Œæœ›** åªèƒ½è®¿é—®æˆ‘æœ‰æƒé™çš„åè®®  
**ä»¥ä¾¿** ä¿æŠ¤æˆ‘çš„éšç§å’Œæ•°æ®å®‰å…¨

**éªŒæ”¶æ ‡å‡†:**
- [ ] ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„åè®®
- [ ] ç”¨æˆ·æ— æ³•è®¿é—®å…¶ä»–ç”¨æˆ·çš„ç§æœ‰åè®®
- [ ] ç”¨æˆ·æ— æ³•ä¿®æ”¹æ²¡æœ‰writeæƒé™çš„åè®®
- [ ] ç”¨æˆ·æ— æ³•æ‰§è¡Œæ²¡æœ‰executeæƒé™çš„åè®®
- [ ] è®¿é—®è¢«æ‹’ç»æ—¶è¿”å›403 Forbiddené”™è¯¯

**æµ‹è¯•ç”¨ä¾‹:**
```typescript
// TC-003: è®¿é—®æ§åˆ¶éªŒè¯
Given ç”¨æˆ·Aåˆ›å»ºäº†ç§æœ‰åè®®
And ç”¨æˆ·Bå°è¯•è®¿é—®è¯¥åè®®
When ç”¨æˆ·Bè¯·æ±‚åè®®è¯¦æƒ…
Then è¿”å›403 Forbiddené”™è¯¯
And ç”¨æˆ·Bæ— æ³•çœ‹åˆ°åè®®å†…å®¹

// TC-004: æƒé™æ£€æŸ¥
Given ç”¨æˆ·Aæœ‰åè®®çš„readæƒé™
And ç”¨æˆ·Aæ²¡æœ‰writeæƒé™
When ç”¨æˆ·Aå°è¯•ä¿®æ”¹åè®®
Then è¿”å›403 Forbiddené”™è¯¯
And åè®®å†…å®¹ä¿æŒä¸å˜
```

### Epic 2: åè®®åˆ†äº«ä¸åä½œ

#### US-003: åè®®åˆ†äº«
**ä½œä¸º** åè®®æ‰€æœ‰è€…  
**æˆ‘å¸Œæœ›** èƒ½å¤Ÿå°†åè®®åˆ†äº«ç»™å…¶ä»–ç”¨æˆ·  
**ä»¥ä¾¿** æˆ‘ä»¬å¯ä»¥åä½œè®­ç»ƒ

**éªŒæ”¶æ ‡å‡†:**
- [ ] ç”¨æˆ·å¯ä»¥åˆ†äº«åè®®ç»™å…¶ä»–ç”¨æˆ·
- [ ] åˆ†äº«æ—¶å¯ä»¥è®¾ç½®æƒé™çº§åˆ«
- [ ] è¢«åˆ†äº«ç”¨æˆ·ä¼šæ”¶åˆ°é€šçŸ¥
- [ ] åˆ†äº«å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´
- [ ] åˆ†äº«å¯ä»¥éšæ—¶æ’¤é”€

**æµ‹è¯•ç”¨ä¾‹:**
```typescript
// TC-005: åˆ†äº«åè®®
Given ç”¨æˆ·Aæœ‰åè®®çš„æ‰€æœ‰æƒé™
When ç”¨æˆ·Aåˆ†äº«åè®®ç»™ç”¨æˆ·Bï¼Œæƒé™ä¸º["read", "execute"]
Then åˆ†äº«åˆ›å»ºæˆåŠŸ
And ç”¨æˆ·Bæ”¶åˆ°åˆ†äº«é€šçŸ¥
And ç”¨æˆ·Bå¯ä»¥æŸ¥çœ‹åè®®
And ç”¨æˆ·Bå¯ä»¥æ‰§è¡Œåè®®
But ç”¨æˆ·Bæ— æ³•ä¿®æ”¹åè®®

// TC-006: åˆ†äº«æƒé™éªŒè¯
Given ç”¨æˆ·Aåˆ†äº«äº†åè®®ç»™ç”¨æˆ·B
When ç”¨æˆ·Bå°è¯•ä¿®æ”¹åè®®
Then è¿”å›403 Forbiddené”™è¯¯
And æ˜¾ç¤º"æ‚¨æ²¡æœ‰ä¿®æ”¹æ­¤åè®®çš„æƒé™"
```

#### US-004: åˆ†äº«ç®¡ç†
**ä½œä¸º** åè®®æ‰€æœ‰è€…  
**æˆ‘å¸Œæœ›** èƒ½å¤Ÿç®¡ç†åè®®çš„åˆ†äº«è®¾ç½®  
**ä»¥ä¾¿** æˆ‘å¯ä»¥æ§åˆ¶è°å¯ä»¥è®¿é—®æˆ‘çš„åè®®

**éªŒæ”¶æ ‡å‡†:**
- [ ] ç”¨æˆ·å¯ä»¥æŸ¥çœ‹æ‰€æœ‰åˆ†äº«çš„åè®®
- [ ] ç”¨æˆ·å¯ä»¥ä¿®æ”¹åˆ†äº«æƒé™
- [ ] ç”¨æˆ·å¯ä»¥æ’¤é”€åˆ†äº«
- [ ] ç”¨æˆ·å¯ä»¥æŸ¥çœ‹åˆ†äº«å†å²
- [ ] è¿‡æœŸçš„åˆ†äº«è‡ªåŠ¨å¤±æ•ˆ

**æµ‹è¯•ç”¨ä¾‹:**
```typescript
// TC-007: åˆ†äº«ç®¡ç†
Given ç”¨æˆ·Aåˆ†äº«äº†åè®®ç»™ç”¨æˆ·Bå’Œç”¨æˆ·C
When ç”¨æˆ·AæŸ¥çœ‹åˆ†äº«ç®¡ç†é¡µé¢
Then æ˜¾ç¤ºæ‰€æœ‰åˆ†äº«çš„åè®®
And æ˜¾ç¤ºæ¯ä¸ªè¢«åˆ†äº«ç”¨æˆ·çš„æƒé™
And æ˜¾ç¤ºåˆ†äº«åˆ›å»ºæ—¶é—´

// TC-008: ä¿®æ”¹åˆ†äº«æƒé™
Given ç”¨æˆ·Aåˆ†äº«äº†åè®®ç»™ç”¨æˆ·Bï¼Œæƒé™ä¸º["read"]
When ç”¨æˆ·Aä¿®æ”¹æƒé™ä¸º["read", "write"]
Then æƒé™æ›´æ–°æˆåŠŸ
And ç”¨æˆ·Bå¯ä»¥ä¿®æ”¹åè®®
```

### Epic 3: å—çº§åˆ«æƒé™

#### US-005: å—æƒé™ç»§æ‰¿
**ä½œä¸º** åè®®ç”¨æˆ·  
**æˆ‘å¸Œæœ›** å—çš„æƒé™ç»§æ‰¿è‡ªåè®®æƒé™  
**ä»¥ä¾¿** æƒé™ç®¡ç†ç®€å•ä¸€è‡´

**éªŒæ”¶æ ‡å‡†:**
- [ ] å—æƒé™ç»§æ‰¿è‡ªåè®®æƒé™
- [ ] ç”¨æˆ·æœ‰åè®®readæƒé™æ—¶ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰å—
- [ ] ç”¨æˆ·æœ‰åè®®writeæƒé™æ—¶ï¼Œå¯ä»¥ä¿®æ”¹æ‰€æœ‰å—
- [ ] ç”¨æˆ·æœ‰åè®®executeæƒé™æ—¶ï¼Œå¯ä»¥æ‰§è¡Œæ‰€æœ‰å—
- [ ] å—æƒé™ä¸èƒ½è¶…è¿‡åè®®æƒé™

**æµ‹è¯•ç”¨ä¾‹:**
```typescript
// TC-009: å—æƒé™ç»§æ‰¿
Given ç”¨æˆ·Aæœ‰åè®®çš„readæƒé™
When ç”¨æˆ·AæŸ¥çœ‹åè®®è¯¦æƒ…
Then å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å—çš„å†…å®¹
But æ— æ³•ä¿®æ”¹ä»»ä½•å—

// TC-010: å—æƒé™é™åˆ¶
Given ç”¨æˆ·Aæœ‰åè®®çš„readæƒé™
When ç”¨æˆ·Aå°è¯•ä¿®æ”¹å—
Then è¿”å›403 Forbiddené”™è¯¯
And æ˜¾ç¤º"æ‚¨æ²¡æœ‰ä¿®æ”¹æ­¤å—çš„æƒé™"
```

#### US-006: å—ç‹¬ç«‹æƒé™
**ä½œä¸º** åè®®æ‰€æœ‰è€…  
**æˆ‘å¸Œæœ›** èƒ½å¤Ÿä¸ºç‰¹å®šå—è®¾ç½®ç‹¬ç«‹æƒé™  
**ä»¥ä¾¿** æˆ‘å¯ä»¥ç²¾ç»†æ§åˆ¶è®¿é—®æƒé™

**éªŒæ”¶æ ‡å‡†:**
- [ ] åè®®æ‰€æœ‰è€…å¯ä»¥ä¸ºå—è®¾ç½®ç‹¬ç«‹æƒé™
- [ ] å—æƒé™å¯ä»¥è¦†ç›–åè®®æƒé™
- [ ] å—æƒé™ä¸èƒ½è¶…è¿‡åè®®æƒé™
- [ ] ç”¨æˆ·å¯ä»¥çœ‹åˆ°è‡ªå·±çš„å—æƒé™

**æµ‹è¯•ç”¨ä¾‹:**
```typescript
// TC-011: å—ç‹¬ç«‹æƒé™
Given ç”¨æˆ·Aæœ‰åè®®çš„æ‰€æœ‰æƒé™
When ç”¨æˆ·Aä¸ºå—è®¾ç½®ç‹¬ç«‹æƒé™["read"]
Then å—æƒé™è®¾ç½®æˆåŠŸ
And å…¶ä»–ç”¨æˆ·åªèƒ½è¯»å–è¯¥å—
But æ— æ³•ä¿®æ”¹è¯¥å—

// TC-012: å—æƒé™è¦†ç›–
Given ç”¨æˆ·Aæœ‰åè®®çš„readæƒé™
And ç”¨æˆ·Aè¢«æˆäºˆç‰¹å®šå—çš„writeæƒé™
When ç”¨æˆ·Aå°è¯•ä¿®æ”¹è¯¥å—
Then ä¿®æ”¹æˆåŠŸ
But æ— æ³•ä¿®æ”¹å…¶ä»–å—
```

### Epic 4: å…¬å¼€åè®®ç®¡ç†

#### US-007: å…¬å¼€åè®®è®¿é—®
**ä½œä¸º** ä¸€ä¸ªç”¨æˆ·  
**æˆ‘å¸Œæœ›** èƒ½å¤Ÿæµè§ˆå’Œè®¿é—®å…¬å¼€åè®®  
**ä»¥ä¾¿** æˆ‘å¯ä»¥å‘ç°å’Œå­¦ä¹ æ–°çš„è®­ç»ƒæ–¹æ³•

**éªŒæ”¶æ ‡å‡†:**
- [ ] ç”¨æˆ·å¯ä»¥æµè§ˆå…¬å¼€åè®®åˆ—è¡¨
- [ ] ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å…¬å¼€åè®®è¯¦æƒ…
- [ ] å…¬å¼€åè®®é»˜è®¤åªæœ‰readæƒé™
- [ ] ç”¨æˆ·å¯ä»¥å¤åˆ¶å…¬å¼€åè®®åˆ°è‡ªå·±çš„åº“
- [ ] å…¬å¼€åè®®æ˜¾ç¤ºåˆ›å»ºè€…ä¿¡æ¯

**æµ‹è¯•ç”¨ä¾‹:**
```typescript
// TC-013: æµè§ˆå…¬å¼€åè®®
Given ç³»ç»Ÿä¸­æœ‰å…¬å¼€åè®®
When ç”¨æˆ·è®¿é—®å…¬å¼€åè®®é¡µé¢
Then æ˜¾ç¤ºæ‰€æœ‰å…¬å¼€åè®®
And ç”¨æˆ·å¯ä»¥æŸ¥çœ‹åè®®è¯¦æƒ…
But æ— æ³•ä¿®æ”¹åè®®

// TC-014: å¤åˆ¶å…¬å¼€åè®®
Given ç”¨æˆ·Aæœ‰å…¬å¼€åè®®çš„readæƒé™
When ç”¨æˆ·Aå¤åˆ¶åè®®åˆ°è‡ªå·±çš„åº“
Then å¤åˆ¶æˆåŠŸ
And ç”¨æˆ·Aè·å¾—æ–°åè®®çš„æ‰€æœ‰æƒé™
And åŸåè®®ä¿æŒä¸å˜
```

#### US-008: å…¬å¼€åè®®ç®¡ç†
**ä½œä¸º** åè®®æ‰€æœ‰è€…  
**æˆ‘å¸Œæœ›** èƒ½å¤Ÿç®¡ç†åè®®çš„å…¬å¼€çŠ¶æ€  
**ä»¥ä¾¿** æˆ‘å¯ä»¥æ§åˆ¶åè®®çš„å¯è§æ€§

**éªŒæ”¶æ ‡å‡†:**
- [ ] ç”¨æˆ·å¯ä»¥è®¾ç½®åè®®ä¸ºå…¬å¼€æˆ–ç§æœ‰
- [ ] å…¬å¼€åè®®å¯ä»¥è¢«æ‰€æœ‰ç”¨æˆ·æŸ¥çœ‹
- [ ] ç§æœ‰åè®®åªèƒ½è¢«æˆæƒç”¨æˆ·æŸ¥çœ‹
- [ ] ç”¨æˆ·å¯ä»¥éšæ—¶æ›´æ”¹å…¬å¼€çŠ¶æ€
- [ ] å…¬å¼€çŠ¶æ€å˜æ›´ä¼šé€šçŸ¥ç›¸å…³ç”¨æˆ·

**æµ‹è¯•ç”¨ä¾‹:**
```typescript
// TC-015: è®¾ç½®åè®®å…¬å¼€
Given ç”¨æˆ·Aæœ‰ç§æœ‰åè®®
When ç”¨æˆ·Aè®¾ç½®åè®®ä¸ºå…¬å¼€
Then åè®®å˜ä¸ºå…¬å¼€
And æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥æŸ¥çœ‹åè®®
And ç”¨æˆ·Aæ”¶åˆ°ç¡®è®¤é€šçŸ¥

// TC-016: è®¾ç½®åè®®ç§æœ‰
Given ç”¨æˆ·Aæœ‰å…¬å¼€åè®®
When ç”¨æˆ·Aè®¾ç½®åè®®ä¸ºç§æœ‰
Then åè®®å˜ä¸ºç§æœ‰
And åªæœ‰æˆæƒç”¨æˆ·å¯ä»¥çœ‹åˆ°åè®®
And å…¶ä»–ç”¨æˆ·æ— æ³•è®¿é—®åè®®
```

### Epic 5: æƒé™éªŒè¯ä¸é”™è¯¯å¤„ç†

#### US-009: æƒé™éªŒè¯
**ä½œä¸º** ç³»ç»Ÿ  
**æˆ‘å¸Œæœ›** èƒ½å¤ŸéªŒè¯æ¯ä¸ªè¯·æ±‚çš„æƒé™  
**ä»¥ä¾¿** ç¡®ä¿æ•°æ®å®‰å…¨å’Œè®¿é—®æ§åˆ¶

**éªŒæ”¶æ ‡å‡†:**
- [ ] æ¯ä¸ªAPIè¯·æ±‚éƒ½éªŒè¯ç”¨æˆ·æƒé™
- [ ] æƒé™éªŒè¯åœ¨ä¸­é—´ä»¶å±‚è¿›è¡Œ
- [ ] æƒé™éªŒè¯å¤±è´¥è¿”å›é€‚å½“çš„é”™è¯¯ç 
- [ ] æƒé™éªŒè¯æ—¥å¿—è®°å½•
- [ ] æƒé™éªŒè¯æ€§èƒ½ä¼˜åŒ–

**æµ‹è¯•ç”¨ä¾‹:**
```typescript
// TC-017: æƒé™éªŒè¯ä¸­é—´ä»¶
Given ç”¨æˆ·Aè¯·æ±‚åè®®è¯¦æƒ…
When ç³»ç»ŸéªŒè¯æƒé™
Then æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰readæƒé™
And æƒé™éªŒè¯é€šè¿‡
And è¿”å›åè®®æ•°æ®

// TC-018: æƒé™éªŒè¯å¤±è´¥
Given ç”¨æˆ·Aæ²¡æœ‰åè®®æƒé™
When ç”¨æˆ·Aè¯·æ±‚åè®®è¯¦æƒ…
Then æƒé™éªŒè¯å¤±è´¥
And è¿”å›403 Forbiddené”™è¯¯
And è®°å½•æƒé™éªŒè¯æ—¥å¿—
```

#### US-010: é”™è¯¯å¤„ç†
**ä½œä¸º** ä¸€ä¸ªç”¨æˆ·  
**æˆ‘å¸Œæœ›** åœ¨æƒé™é”™è¯¯æ—¶æ”¶åˆ°æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯  
**ä»¥ä¾¿** æˆ‘çŸ¥é“å¦‚ä½•è§£å†³é—®é¢˜

**éªŒæ”¶æ ‡å‡†:**
- [ ] æƒé™é”™è¯¯è¿”å›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- [ ] é”™è¯¯ä¿¡æ¯åŒ…å«å»ºè®®çš„è§£å†³æ–¹æ¡ˆ
- [ ] é”™è¯¯ä¿¡æ¯æœ¬åœ°åŒ–æ”¯æŒ
- [ ] é”™è¯¯ä¿¡æ¯ä¸æ³„éœ²æ•æ„Ÿä¿¡æ¯
- [ ] é”™è¯¯ä¿¡æ¯åŒ…å«è¯·æ±‚IDç”¨äºè°ƒè¯•

**æµ‹è¯•ç”¨ä¾‹:**
```typescript
// TC-019: æƒé™é”™è¯¯ä¿¡æ¯
Given ç”¨æˆ·Aæ²¡æœ‰åè®®æƒé™
When ç”¨æˆ·Aè¯·æ±‚åè®®è¯¦æƒ…
Then è¿”å›403 Forbiddené”™è¯¯
And é”™è¯¯ä¿¡æ¯ä¸º"æ‚¨æ²¡æœ‰è®¿é—®æ­¤åè®®çš„æƒé™"
And é”™è¯¯ä¿¡æ¯åŒ…å«è¯·æ±‚ID

// TC-020: æƒé™é”™è¯¯æœ¬åœ°åŒ–
Given ç”¨æˆ·Aè®¾ç½®è¯­è¨€ä¸ºä¸­æ–‡
And ç”¨æˆ·Aæ²¡æœ‰åè®®æƒé™
When ç”¨æˆ·Aè¯·æ±‚åè®®è¯¦æƒ…
Then è¿”å›ä¸­æ–‡é”™è¯¯ä¿¡æ¯
And é”™è¯¯ä¿¡æ¯ä¸º"æ‚¨æ²¡æœ‰è®¿é—®æ­¤åè®®çš„æƒé™"
```

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹è¯¦ç»†è§„èŒƒ

### å•å…ƒæµ‹è¯•ç”¨ä¾‹

#### æƒé™éªŒè¯æµ‹è¯•
```typescript
describe('Permission Validation', () => {
  test('should allow read access with read permission', () => {
    const user = { id: 'user1', permissions: ['read'] };
    const protocol = { id: 'protocol1', ownerId: 'user1' };
    
    const hasAccess = checkPermission(user, protocol, 'read');
    expect(hasAccess).toBe(true);
  });
  
  test('should deny write access without write permission', () => {
    const user = { id: 'user1', permissions: ['read'] };
    const protocol = { id: 'protocol1', ownerId: 'user1' };
    
    const hasAccess = checkPermission(user, protocol, 'write');
    expect(hasAccess).toBe(false);
  });
});
```

#### åˆ†äº«åŠŸèƒ½æµ‹è¯•
```typescript
describe('Protocol Sharing', () => {
  test('should create share with correct permissions', async () => {
    const shareData = {
      protocolId: 'protocol1',
      sharedBy: 'user1',
      sharedWith: 'user2',
      permissions: ['read', 'execute']
    };
    
    const share = await createProtocolShare(shareData);
    expect(share.permissions).toEqual(['read', 'execute']);
    expect(share.isActive).toBe(true);
  });
  
  test('should validate share permissions', () => {
    const shareData = {
      protocolId: 'protocol1',
      sharedBy: 'user1',
      sharedWith: 'user2',
      permissions: ['invalid_permission']
    };
    
    expect(() => createProtocolShare(shareData)).toThrow('Invalid permission');
  });
});
```

### é›†æˆæµ‹è¯•ç”¨ä¾‹

#### APIæƒé™æµ‹è¯•
```typescript
describe('API Permission Tests', () => {
  test('should return 403 for unauthorized access', async () => {
    const response = await request(app)
      .get('/api/v1/protocols/protocol1')
      .set('Authorization', 'Bearer invalid-token');
    
    expect(response.status).toBe(403);
    expect(response.body.error).toBe('forbidden');
  });
  
  test('should return protocol data for authorized access', async () => {
    const token = generateTestToken('user1');
    const response = await request(app)
      .get('/api/v1/protocols/protocol1')
      .set('Authorization', `Bearer ${token}`);
    
    expect(response.status).toBe(200);
    expect(response.body.id).toBe('protocol1');
  });
});
```

#### æ•°æ®åº“æƒé™æµ‹è¯•
```typescript
describe('Database Permission Tests', () => {
  test('should enforce RLS policies', async () => {
    // è®¾ç½®ç”¨æˆ·Açš„ä¸Šä¸‹æ–‡
    await setUserContext('userA');
    
    // ç”¨æˆ·Aåº”è¯¥åªèƒ½çœ‹åˆ°è‡ªå·±çš„åè®®
    const protocols = await prisma.protocol.findMany();
    expect(protocols.every(p => p.createdBy === 'userA')).toBe(true);
  });
  
  test('should prevent cross-user access', async () => {
    // è®¾ç½®ç”¨æˆ·Açš„ä¸Šä¸‹æ–‡
    await setUserContext('userA');
    
    // å°è¯•è®¿é—®ç”¨æˆ·Bçš„åè®®åº”è¯¥å¤±è´¥
    await expect(
      prisma.protocol.findUnique({ where: { id: 'userB-protocol' } })
    ).rejects.toThrow('Access denied');
  });
});
```

### ç«¯åˆ°ç«¯æµ‹è¯•ç”¨ä¾‹

#### ç”¨æˆ·æµç¨‹æµ‹è¯•
```typescript
describe('User Flow Tests', () => {
  test('complete protocol sharing flow', async () => {
    // 1. ç”¨æˆ·Aåˆ›å»ºåè®®
    const protocol = await createProtocol({
      name: 'Test Protocol',
      createdBy: 'userA'
    });
    
    // 2. ç”¨æˆ·Aåˆ†äº«åè®®ç»™ç”¨æˆ·B
    const share = await shareProtocol({
      protocolId: protocol.id,
      sharedBy: 'userA',
      sharedWith: 'userB',
      permissions: ['read', 'execute']
    });
    
    // 3. ç”¨æˆ·Bæ¥å—åˆ†äº«
    await acceptProtocolShare(share.id, 'userB');
    
    // 4. ç”¨æˆ·Bå¯ä»¥æŸ¥çœ‹åè®®
    const userBProtocols = await getUserProtocols('userB');
    expect(userBProtocols).toContainEqual(expect.objectContaining({
      id: protocol.id
    }));
    
    // 5. ç”¨æˆ·Bå¯ä»¥æ‰§è¡Œåè®®
    const execution = await startProtocolExecution(protocol.id, 'userB');
    expect(execution.status).toBe('active');
  });
});
```

## ğŸ¨ å‰ç«¯ç”¨æˆ·ä½“éªŒè®¾è®¡

### æƒé™ç®¡ç†ç•Œé¢

#### åè®®æƒé™è®¾ç½®é¡µé¢
```typescript
interface ProtocolPermissionsPage {
  // åè®®åŸºæœ¬ä¿¡æ¯
  protocol: {
    id: string;
    name: string;
    isPublic: boolean;
    ownerId: string;
  };
  
  // åˆ†äº«è®¾ç½®
  sharing: {
    isPublic: boolean;
    shares: Array<{
      id: string;
      sharedWith: string;
      permissions: Permission[];
      expiresAt?: Date;
      isActive: boolean;
    }>;
  };
  
  // æƒé™ç®¡ç†
  permissions: {
    canEdit: boolean;
    canExecute: boolean;
    canShare: boolean;
  };
}
```

#### åˆ†äº«åè®®å¯¹è¯æ¡†
```typescript
interface ShareProtocolDialog {
  // åˆ†äº«ç›®æ ‡
  targetUser: {
    id: string;
    email: string;
    name: string;
  };
  
  // æƒé™é€‰æ‹©
  permissions: {
    read: boolean;
    write: boolean;
    execute: boolean;
    share: boolean;
  };
  
  // è¿‡æœŸè®¾ç½®
  expiration: {
    enabled: boolean;
    date?: Date;
  };
  
  // æ¶ˆæ¯
  message: string;
}
```

#### æƒé™çŠ¶æ€æŒ‡ç¤ºå™¨
```typescript
interface PermissionIndicator {
  // æƒé™å›¾æ ‡
  icons: {
    read: 'eye' | 'eye-off';
    write: 'edit' | 'edit-off';
    execute: 'play' | 'play-off';
    share: 'share' | 'share-off';
  };
  
  // æƒé™æ ‡ç­¾
  labels: {
    read: 'æŸ¥çœ‹';
    write: 'ç¼–è¾‘';
    execute: 'æ‰§è¡Œ';
    share: 'åˆ†äº«';
  };
  
  // æƒé™çŠ¶æ€
  status: 'granted' | 'denied' | 'pending';
}
```

### ç”¨æˆ·äº¤äº’æµç¨‹

#### åˆ†äº«åè®®æµç¨‹
1. **é€‰æ‹©åè®®**: ç”¨æˆ·åœ¨åè®®åˆ—è¡¨ä¸­é€‰æ‹©è¦åˆ†äº«çš„åè®®
2. **ç‚¹å‡»åˆ†äº«**: ç”¨æˆ·ç‚¹å‡»"åˆ†äº«"æŒ‰é’®
3. **é€‰æ‹©ç”¨æˆ·**: ç”¨æˆ·æœç´¢å¹¶é€‰æ‹©è¦åˆ†äº«çš„ç”¨æˆ·
4. **è®¾ç½®æƒé™**: ç”¨æˆ·é€‰æ‹©è¦æˆäºˆçš„æƒé™
5. **è®¾ç½®è¿‡æœŸ**: ç”¨æˆ·å¯é€‰æ‹©è®¾ç½®åˆ†äº«è¿‡æœŸæ—¶é—´
6. **å‘é€é‚€è¯·**: ç”¨æˆ·å‘é€åˆ†äº«é‚€è¯·
7. **ç¡®è®¤åˆ†äº«**: è¢«åˆ†äº«ç”¨æˆ·æ¥å—æˆ–æ‹’ç»é‚€è¯·

#### æƒé™ç®¡ç†æµç¨‹
1. **æŸ¥çœ‹æƒé™**: ç”¨æˆ·æŸ¥çœ‹å½“å‰åè®®çš„æƒé™è®¾ç½®
2. **ä¿®æ”¹æƒé™**: ç”¨æˆ·ä¿®æ”¹ç°æœ‰åˆ†äº«çš„æƒé™
3. **æ’¤é”€åˆ†äº«**: ç”¨æˆ·æ’¤é”€ä¸éœ€è¦çš„åˆ†äº«
4. **è®¾ç½®å…¬å¼€**: ç”¨æˆ·è®¾ç½®åè®®ä¸ºå…¬å¼€æˆ–ç§æœ‰
5. **ä¿å­˜æ›´æ”¹**: ç”¨æˆ·ä¿å­˜æƒé™æ›´æ”¹

## ğŸ“Š æˆåŠŸæ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§
- [ ] æ‰€æœ‰ç”¨æˆ·æ•…äº‹å®ç°å®Œæˆ
- [ ] æ‰€æœ‰éªŒæ”¶æ ‡å‡†æ»¡è¶³
- [ ] æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- [ ] æƒé™éªŒè¯100%è¦†ç›–

### å®‰å…¨æ€§
- [ ] æ— æƒé™ç»•è¿‡æ¼æ´
- [ ] æ— æ•°æ®æ³„éœ²é£é™©
- [ ] æƒé™éªŒè¯æ€§èƒ½è‰¯å¥½
- [ ] é”™è¯¯å¤„ç†å®‰å…¨

### ç”¨æˆ·ä½“éªŒ
- [ ] æƒé™ç•Œé¢ç›´è§‚æ˜“ç”¨
- [ ] é”™è¯¯ä¿¡æ¯æ¸…æ™°æ˜ç¡®
- [ ] æ“ä½œæµç¨‹ç®€å•é«˜æ•ˆ
- [ ] å“åº”æ—¶é—´æ»¡è¶³è¦æ±‚

### å¯ç»´æŠ¤æ€§
- [ ] ä»£ç ç»“æ„æ¸…æ™°
- [ ] æµ‹è¯•è¦†ç›–å……åˆ†
- [ ] æ–‡æ¡£å®Œæ•´å‡†ç¡®
- [ ] æ˜“äºæ‰©å±•ä¿®æ”¹

## ğŸš€ å®æ–½è®¡åˆ’

### ç¬¬1å‘¨: åŸºç¡€æƒé™ç³»ç»Ÿ
- [ ] å®ç°åè®®æ‰€æœ‰æƒç®¡ç†
- [ ] å®ç°åŸºç¡€æƒé™éªŒè¯
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
- [ ] å®ç°APIæƒé™ä¸­é—´ä»¶

### ç¬¬2å‘¨: åˆ†äº«ä¸åä½œ
- [ ] å®ç°åè®®åˆ†äº«åŠŸèƒ½
- [ ] å®ç°åˆ†äº«ç®¡ç†ç•Œé¢
- [ ] ç¼–å†™é›†æˆæµ‹è¯•
- [ ] å®ç°æƒé™ç»§æ‰¿

### ç¬¬3å‘¨: å…¬å¼€åè®®ç®¡ç†
- [ ] å®ç°å…¬å¼€åè®®åŠŸèƒ½
- [ ] å®ç°åè®®å¤åˆ¶åŠŸèƒ½
- [ ] ç¼–å†™ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] å®ç°æƒé™çŠ¶æ€æŒ‡ç¤ºå™¨

### ç¬¬4å‘¨: ä¼˜åŒ–ä¸æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å®‰å…¨æµ‹è¯•
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] æ–‡æ¡£å®Œå–„

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025-09-12T11:00:00.000Z  
**åˆ†æå¸ˆ**: å·¥ç¨‹å¸ˆB (å‰ç«¯é›†æˆä¸“å®¶)  
**çŠ¶æ€**: å®Œæˆ âœ…  
**ç›®æ ‡**: ä¸ºWeek 1 Sprintæä¾›å®Œæ•´çš„æƒé™ç³»ç»Ÿç”¨æˆ·æ•…äº‹å’Œæµ‹è¯•ç”¨ä¾‹
